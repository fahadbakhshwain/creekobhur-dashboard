import streamlit as st
import pandas as pd
import datetime
import os

# --- ุฏูุงู ุงููุณุงุนุฏุฉ ูุฌูุจ ุงูุจูุงูุงุช (ุงูุชุฑุงุถูุฉ ุญุงููุงู ูุบุฑุถ ุงูุจุฑูุชูุชุงูุจ) ---

def get_summary_data():
    """
    ุชูุฑุฌุน ุจูุงูุงุช ููุฎุตุฉ ููููุฉ ููุฃูุณุงู ุงููุฎุชููุฉ.
    ูู ุงููุณุชูุจูุ ุณุชููู ุจุฌูุจ ุงูุจูุงูุงุช ุงููุนููุฉ ูู ููุงุนุฏ ุงูุจูุงูุงุช/ูููุงุช CSV.
    """
    return {
        "ุงูุดูุงุทุฆ ูุงููุงุดูุฑุงุช": {"ุญุงูุฉ": "ุฌูุฏ", "ูุดุงูู_ูุงุดูุฑุงุช": 0, "ุตูุญุฉ": "ุงูุดูุงุทุฆ.py", "icon": "๐ด"},
        "ุฏูุฑุงุช ุงูููุงู": {"ุญุงูุฉ": "ูุญุชุงุฌ ูุชุงุจุนุฉ", "ููุงูุต_ููุงุฏ": 2, "ุตูุญุฉ": "ุฏูุฑุงุช_ุงูููุงู.py", "icon": "๐ฝ"},
        "ุงููุดุฑููู": {"ุญุงูุฉ": "ููุชุงุฒ", "ุบูุงุจ_ุงูููู": 0, "ุตูุญุฉ": "ุงูููุธููู.py", "icon": "๐งโ๐คโ๐ง"}, # ุงุณู ุงูููู ุงูููุธููู.py
        "ุงูุดุฑูุฉ ุงูุฃูููุฉ": {"ุญุงูุฉ": "ูุณุชูุฑุฉ", "ุจูุงุบุงุช_ุงูููู": 1, "ุตูุญุฉ": "ุงูุดุฑูุฉ_ุงูุงูููุฉ.py", "icon": "๐ก๏ธ"},
        "ูุฑูุฒ ุงููุฑุงูุจุฉ ูุงูุชุญูู": {"ุญุงูุฉ": "ุชุดุบูู ุทุจูุนู", "ูุดุงูู_ุชูููุฉ": 0, "ุตูุญุฉ": "ูุฑูุฒ_ุงููุฑุงูุจุฉ.py", "icon": "๐ฅ๏ธ"},
        "ุงูููุงุทู ุงูุงุณุชุซูุงุฑูุฉ (ููููุงู)": {"ุญุงูุฉ": "ุฌูุฏ", "ูุดุงูู_ุตูุงูุฉ": 0, "ุตูุญุฉ": "ููููุงู.py", "icon": "๐๏ธ"},
        "ุงููุณุชูุฏุน": {"ุญุงูุฉ": "ูุชููุฑ", "ููุงูุต_ูุฎุฒูู": 0, "ุตูุญุฉ": "ุงููุณุชูุฏุน.py", "icon": "๐ฆ"},
        "ุนูุงู ูุนุงููุงุช ุงููุธุงูุฉ": {"ุญุงูุฉ": "ุฌููุนูู ูุชูุงุฌุฏูู", "ููุงู_ูุนููุฉ": 3, "ุตูุญุฉ": "ุนูุงู_ุงููุธุงูุฉ.py", "icon": "๐งน"},
        "ุงูุณุงุฆููู ูุณูุงุฑุงุช ุงูุฌููู": {"ุญุงูุฉ": "ุฌุงูุฒูู", "ูุฑูุจุงุช_ูุชุนุทูุฉ": 0, "ุตูุญุฉ": "ุงูุณุงุฆููู.py", "icon": "๐"},
        "ูุณู ุงูุตูุงูุฉ": {"ุญุงูุฉ": "ููุฏ ุงููุฑุงุฌุนุฉ", "ุทูุจุงุช_ูุนููุฉ": 5, "ุตูุญุฉ": "ูุณู_ุงูุตูุงูุฉ.py", "icon": "๐ง"},
        "ูุณู ุงูุฒุฑุงุนุฉ": {"ุญุงูุฉ": "ููุชุงุฒ", "ููุงู_ุฑู_ูุนููุฉ": 0, "ุตูุญุฉ": "ูุณู_ุงูุฒุฑุงุนุฉ.py", "icon": "๐ณ"},
        "ูุณู ุงูุจุญุฑูุฉ": {"ุญุงูุฉ": "ุฌูุฏ", "ุญูุงุฏุซ_ุงูููู": 0, "ุตูุญุฉ": "ูุณู_ุงูุจุญุฑูุฉ.py", "icon": "โ"},
        "ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ": {"ุญุงูุฉ": "ุฌูุฏ", "ุทูุจุงุช_ุงุฌุงุฒุฉ": 1, "ุตูุญุฉ": "ุงูููุงุฑุฏ_ุงูุจุดุฑูุฉ.py", "icon": "๐ฅ"},
        "ุชูููุฉ ุงููุนูููุงุช (IT)": {"ุญุงูุฉ": "ูุง ุชูุฌุฏ ูุดุงูู", "ูุดุงูู_ุฏุนู": 0, "ุตูุญุฉ": "ุชูููุฉ_ุงููุนูููุงุช.py", "icon": "๐ป"},
        "ุงููุญุงุณุจุฉ": {"ุญุงูุฉ": "ุฌูุฏ", "ูุฏููุนุงุช_ูุนููุฉ": 0, "ุตูุญุฉ": "ุงููุญุงุณุจุฉ.py", "icon": "๐ต"},
        "ูุณุงุนุฏุฉ ุงููุฏูุฑุฉ": {"ุญุงูุฉ": "ูุณุชูุฑุฉ", "ููุงู_ูุนููุฉ": 2, "ุตูุญุฉ": "ูุณุงุนุฏุฉ_ุงููุฏูุฑุฉ.py", "icon": "๐ฉโ๐ผ"},
    }

def load_admin_tasks():
    """
    ุชุญููู ุงูููุงู ุงูุฅุฏุงุฑูุฉ ุงููุนููุฉ (ููููุฉ ุญุงููุงู).
    """
    tasks = [
        {"ุงููููุฉ": "ูุฑุงุฌุนุฉ ูุดููุงุช ุงูุฏูุงู ุงูููุงุฆูุฉ ูุดูุฑ ููููู.", "ุงูุญุงูุฉ": "ูุนููุฉ", "ุงูููุนุฏ_ุงูููุงุฆู": "2025-07-05"},
        {"ุงููููุฉ": "ุนูุฏ ุงุฌุชูุงุน ูุน ุงูุดุฑูุฉ ุงูุฃูููุฉ ููุฑุงุฌุนุฉ ุจุฑูุชููููุงุช ุงูุฃูุงู.", "ุงูุญุงูุฉ": "ูุนููุฉ", "ุงูููุนุฏ_ุงูููุงุฆู": "2025-07-08"},
        {"ุงููููุฉ": "ุงูุชุฃูุฏ ูู ุชููุฑ ุฌููุน ููุงุฏ ุงููุธุงูุฉ ูู ุฏูุฑุงุช ุงูููุงู ุงููุนููุฉ.", "ุงูุญุงูุฉ": "ูุนููุฉ", "ุงูููุนุฏ_ุงูููุงุฆู": "2025-07-01"},
        {"ุงููููุฉ": "ูุชุงุจุนุฉ ุทูุจุงุช ุงูุตูุงูุฉ ุงููุนููุฉ ูุน ูุณู ุงูุตูุงูุฉ.", "ุงูุญุงูุฉ": "ูุณุชูุฑุฉ", "ุงูููุนุฏ_ุงูููุงุฆู": "ูููู"},
    ]
    return pd.DataFrame(tasks)

# ูุงุฆูุฉ ุจุฃุณูุงุก ุงููููุงุช ุงูุชู ูุฌุจ ุฃู ุชููู ููุฌูุฏุฉ ุจุงููุนู ูู ูุฌูุฏ pages
# ูู ุจุชุญุฏูุซ ูุฐู ุงููุงุฆูุฉ ูุฏููุงู ูุชุดูู ุฌููุน ูููุงุช ุงูุตูุญุงุช ุงูุชู ุฃูุดุฃุชูุง ูุชุนูู ูุฏูู
# ูุฐุง ูุถูุงู ุฃู ุฒุฑ "ุนุฑุถ ุงูุชูุงุตูู" ูุธูุฑ ููุท ููุตูุญุงุช ุงูููุฌูุฏุฉ.
EXISTING_PAGES_FILES = [
    "ุงูููุงู_ุงูููููุฉ.py",
    "ุฏูุฑุงุช_ุงูููุงู.py",
    "ุงูุดูุงุทุฆ.py",
    "ุงูููุธููู.py", # ุงูููุธูููุ ูููุณ ุงูููุธููู_ุงูุญุงูููู
    "ุงูุฅุฏุงุฑุฉ.py",
    "ุงูุดุฑูุฉ_ุงูุงูููุฉ.py",
    "ูุฑูุฒ_ุงููุฑุงูุจุฉ.py",
    "ููููุงู.py",
    "ุงููุณุชูุฏุน.py",
    "ุนูุงู_ุงููุธุงูุฉ.py",
    "ุงูุณุงุฆููู.py",
    "ูุณู_ุงูุตูุงูุฉ.py",
    "ูุณู_ุงูุฒุฑุงุนุฉ.py",
    "ูุณู_ุงูุจุญุฑูุฉ.py",
    "ุงูููุงุฑุฏ_ุงูุจุดุฑูุฉ.py",
    "ุชูููุฉ_ุงููุนูููุงุช.py",
    "ุงููุญุงุณุจุฉ.py",
    "ูุณุงุนุฏุฉ_ุงููุฏูุฑุฉ.py",
    # ุฅุฐุง ูุงู ูุฏูู ุฃู ุตูุญุงุช ุฃุฎุฑู ูุซู "ุงูุทูุงุฑุฆ.py" ุฃุถููุง ููุง ุฃูุถุงู
]

# --- ุฏุงูุฉ ูุณุงุนุฏุฉ ูุฑุณู ุงููุฑุช ---
def display_section_card(section_name, data, page_map):
    """ุชุนุฑุถ ุจุทุงูุฉ ููุฎุต ููุณู ูุนูู."""
    st.markdown(f"#### {data.get('icon', '')} {section_name}")
    status = data.get('ุญุงูุฉ', 'ุบูุฑ ูุนุฑูู')
    if status in ["ุฌูุฏ", "ููุชุงุฒ", "ุชุดุบูู ุทุจูุนู", "ูุชููุฑ", "ุฌุงูุฒูู", "ูุง ุชูุฌุฏ ูุดุงูู", "ูุณุชูุฑุฉ"]:
        st.success(f"ุงูุญุงูุฉ: {status}")
    elif status in ["ูุญุชุงุฌ ูุชุงุจุนุฉ", "ููุฏ ุงููุฑุงุฌุนุฉ", "ูุณุชูุฑุฉ"]:
        st.warning(f"ุงูุญุงูุฉ: {status}")
    else:
        st.error(f"ุงูุญุงูุฉ: {status}")

    for key, value in data.items():
        if key not in ["ุญุงูุฉ", "ุตูุญุฉ", "icon"]:
            st.metric(label=key.replace("_", " ").title(), value=value)

    target_page_file = data.get('ุตูุญุฉ')
    # ูุณุชุฎุฏู page_map ุฅุฐุง ูุงู ููุงู ุงุณู ููู ูุฎุชูู ุนู ุงุณู ุงููุณู
    if section_name in page_map:
        target_page_file = page_map[section_name]

    if target_page_file and target_page_file in EXISTING_PAGES_FILES:
        if st.button(f"ุนุฑุถ ุชูุงุตูู {section_name}", key=f"btn_{section_name.replace(' ', '_')}"):
            st.switch_page(f"pages/{target_page_file}")
    # else: ูุง ุชุนุฑุถ ุงูุฒุฑ ุฃู ุฑุณุงูุฉ "ูุง ุชูุฌุฏ" ุฅุฐุง ูุงูุช ุงูุตูุญุฉ ุบูุฑ ููุฌูุฏุฉ

# --- ุงูููุฏ ุงูุฑุฆูุณู ูุตูุญุฉ ุงูุฅุฏุงุฑุฉ ---

def run(): # <--- ุชุฃูุฏ ุฃู ูุฐุง ุงูุณุทุฑ ููุฌูุฏ ูุตุญูุญ ูู ุงูุฅุฏุงุฑุฉ.py
    st.title("๐ข ููุญุฉ ุชุญูู ุงูุฅุฏุงุฑุฉ")
    st.info("ููุญุฉ ุนุงูุฉ ุนู ุญุงูุฉ ุงููุงุฌูุฉ ุงูุจุญุฑูุฉ ูุงูููุงู ุงูุฅุฏุงุฑูุฉ.")

    summary_data = get_summary_data()

    # ุฎุฑูุทุฉ ูุฃุณูุงุก ุงูุตูุญุงุช ุงููุนููุฉ ุฅุฐุง ูุงูุช ุชุฎุชูู ุนู ุฃุณูุงุก ุงูุฃูุณุงู ุงููุนุฑูุถุฉ
    # (ูุซู "ุงููุดุฑููู" ุงูุชู ุชุฑุชุจุท ุจููู "ุงูููุธููู.py")
    page_map = {
        "ุงูุดูุงุทุฆ ูุงููุงุดูุฑุงุช": "ุงูุดูุงุทุฆ.py",
        "ุฏูุฑุงุช ุงูููุงู": "ุฏูุฑุงุช_ุงูููุงู.py",
        "ุงููุดุฑููู": "ุงูููุธููู.py",
        # ุฃุถู ููุง ุฃู ุฑุจุท ุฎุงุต ุจูู ุงุณู ุงููุณู ูู ุงููุฑุช ูุงุณู ุงูููู ุงููุนูู
        # ุฅุฐุง ูู ููู ููุงู ุงุฎุชูุงูุ ูุง ุฏุงุนู ูุฅุถุงูุชู ููุง
    }

    st.header("ููุฎุต ุญุงูุฉ ุงูุฃูุณุงู ุงูุชุดุบูููุฉ")
    # ุงูุฃูุณุงู ุงูุฃุณุงุณูุฉ ูู ุงููุงุฌูุฉ ุงูุจุญุฑูุฉ
    operational_sections = [
        "ุงูุดูุงุทุฆ ูุงููุงุดูุฑุงุช", "ุฏูุฑุงุช ุงูููุงู", "ุงููุดุฑููู", "ุงูุดุฑูุฉ ุงูุฃูููุฉ",
        "ุนูุงู ูุนุงููุงุช ุงููุธุงูุฉ", "ุงูุณุงุฆููู ูุณูุงุฑุงุช ุงูุฌููู", "ูุณู ุงูุจุญุฑูุฉ"
    ]
    cols = st.columns(2)
    for i, section_name in enumerate(operational_sections):
        with cols[i % 2]: # ุชูุฒูุน ุงูุฃูุณุงู ุนูู ุนููุฏูู
            display_section_card(section_name, summary_data[section_name], page_map)
            st.markdown("---") # ูุงุตู ุจุนุฏ ูู ูุฑุช

    st.header("ููุฎุต ุญุงูุฉ ุงููุฑุงูู ูุงูุฏุนู ุงูููุฌุณุชู")
    # ุงูุฃูุณุงู ุงููุชุนููุฉ ุจุงููุฑุงูู ูุงูุฏุนู
    facility_support_sections = [
        "ูุฑูุฒ ุงููุฑุงูุจุฉ ูุงูุชุญูู", "ุงูููุงุทู ุงูุงุณุชุซูุงุฑูุฉ (ููููุงู)", "ุงููุณุชูุฏุน",
        "ูุณู ุงูุตูุงูุฉ", "ูุณู ุงูุฒุฑุงุนุฉ"
    ]
    cols = st.columns(2)
    for i, section_name in enumerate(facility_support_sections):
        with cols[i % 2]: # ุชูุฒูุน ุงูุฃูุณุงู ุนูู ุนููุฏูู
            display_section_card(section_name, summary_data[section_name], page_map)
            st.markdown("---") # ูุงุตู ุจุนุฏ ูู ูุฑุช

    st.header("ููุฎุต ุญุงูุฉ ุงูุฃูุณุงู ุงูุฅุฏุงุฑูุฉ ูุงููุณุงูุฏุฉ")
    # ุงูุฃูุณุงู ุงูุฅุฏุงุฑูุฉ ูุงููุณุงูุฏุฉ
    admin_support_sections = [
        "ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ", "ุชูููุฉ ุงููุนูููุงุช (IT)", "ุงููุญุงุณุจุฉ", "ูุณุงุนุฏุฉ ุงููุฏูุฑุฉ"
    ]
    cols = st.columns(2)
    for i, section_name in enumerate(admin_support_sections):
        with cols[i % 2]: # ุชูุฒูุน ุงูุฃูุณุงู ุนูู ุนููุฏูู
            display_section_card(section_name, summary_data[section_name], page_map)
            st.markdown("---") # ูุงุตู ุจุนุฏ ูู ูุฑุช

    st.markdown("---") # ุฎุท ูุงุตู ูุจูุฑ

    # --- ูุณู ุงูููุงู ุงูุฅุฏุงุฑูุฉ ุงููุนููุฉ ---
    st.header("ุงูููุงู ุงูุฅุฏุงุฑูุฉ ุงููุนููุฉ")

    admin_tasks = load_admin_tasks()

    if not admin_tasks.empty:
        # ุนุฑุถ ุงูููุงู ูู ุดูู ูุงุฆูุฉ ูุงุถุญุฉ
        for index, task in admin_tasks.iterrows():
            st.markdown(f"##### ๐ ุงููููุฉ: {task['ุงููููุฉ']}")
            status_color = "red" if task['ุงูุญุงูุฉ'] == 'ูุนููุฉ' else "orange" if task['ุงูุญุงูุฉ'] == 'ูุณุชูุฑุฉ' else "green"
            st.markdown(f"**ุงูุญุงูุฉ:** <span style='color: {status_color}; font-weight:bold;'>{task['ุงูุญุงูุฉ']}</span>", unsafe_allow_html=True)
            if pd.notna(task['ุงูููุนุฏ_ุงูููุงุฆู']):
                st.markdown(f"**ุงูููุนุฏ ุงูููุงุฆู:** {task['ุงูููุนุฏ_ุงูููุงุฆู']}")
            st.markdown("---")
    else:
        st.info("๐ ูุง ุชูุฌุฏ ููุงู ุฅุฏุงุฑูุฉ ูุนููุฉ ุญุงููุงู. ูู ุดูุก ุนูู ูุง ูุฑุงู!")

# ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ูุชุดุบูู ุงูุตูุญุฉ
run() # <--- ูุฐุง ุงูุณุทุฑ ูุฌุจ ุฃู ูููู ููุฌูุฏุงู ูุตุญูุญุงู ูู ููุงูุฉ ุงูููู
