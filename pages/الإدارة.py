import streamlit as st
import pandas as pd
import datetime
import os

# --- ุฏูุงู ุงููุณุงุนุฏุฉ ูุฌูุจ ุงูุจูุงูุงุช (ุงูุชุฑุงุถูุฉ ุญุงููุงู ูุบุฑุถ ุงูุจุฑูุชูุชุงูุจ) ---

def get_summary_data():
    """
    ุชูุฑุฌุน ุจูุงูุงุช ููุฎุตุฉ ููููุฉ ููุฃูุณุงู ุงููุฎุชููุฉ.
    ูู ุงููุณุชูุจูุ ุณุชููู ุจุฌูุจ ุงูุจูุงูุงุช ุงููุนููุฉ ูู ููุงุนุฏ ุงูุจูุงูุงุช/ูููุงุช CSV.
    """
    return {
        "ุงูุดูุงุทุฆ ูุงููุงุดูุฑุงุช": {"ุญุงูุฉ": "ุฌูุฏ", "ูุดุงูู_ูุงุดูุฑุงุช": 0, "ุตูุญุฉ": "ุงูุดูุงุทุฆ.py"},
        "ุฏูุฑุงุช ุงูููุงู": {"ุญุงูุฉ": "ูุญุชุงุฌ ูุชุงุจุนุฉ", "ููุงูุต_ููุงุฏ": 2, "ุตูุญุฉ": "ุฏูุฑุงุช_ุงูููุงู.py"},
        "ุงููุดุฑููู": {"ุญุงูุฉ": "ููุชุงุฒ", "ุบูุงุจ_ุงูููู": 0, "ุตูุญุฉ": "ุงูููุธููู.py"}, # ุงุณู ุงูููู ุงูููุธููู.py
        "ุงูุดุฑูุฉ ุงูุฃูููุฉ": {"ุญุงูุฉ": "ูุณุชูุฑุฉ", "ุจูุงุบุงุช_ุงูููู": 1, "ุตูุญุฉ": "ุงูุดุฑูุฉ_ุงูุงูููุฉ.py"},
        "ูุฑูุฒ ุงููุฑุงูุจุฉ ูุงูุชุญูู": {"ุญุงูุฉ": "ุชุดุบูู ุทุจูุนู", "ูุดุงูู_ุชูููุฉ": 0, "ุตูุญุฉ": "ูุฑูุฒ_ุงููุฑุงูุจุฉ.py"},
        "ุงูููุงุทู ุงูุงุณุชุซูุงุฑูุฉ (ููููุงู)": {"ุญุงูุฉ": "ุฌูุฏ", "ูุดุงูู_ุตูุงูุฉ": 0, "ุตูุญุฉ": "ููููุงู.py"},
        "ุงููุณุชูุฏุน": {"ุญุงูุฉ": "ูุชููุฑ", "ููุงูุต_ูุฎุฒูู": 0, "ุตูุญุฉ": "ุงููุณุชูุฏุน.py"},
        "ุนูุงู ูุนุงููุงุช ุงููุธุงูุฉ": {"ุญุงูุฉ": "ุฌููุนูู ูุชูุงุฌุฏูู", "ููุงู_ูุนููุฉ": 3, "ุตูุญุฉ": "ุนูุงู_ุงููุธุงูุฉ.py"},
        "ุงูุณุงุฆููู ูุณูุงุฑุงุช ุงูุฌููู": {"ุญุงูุฉ": "ุฌุงูุฒูู", "ูุฑูุจุงุช_ูุชุนุทูุฉ": 0, "ุตูุญุฉ": "ุงูุณุงุฆููู.py"},
        "ูุณู ุงูุตูุงูุฉ": {"ุญุงูุฉ": "ููุฏ ุงููุฑุงุฌุนุฉ", "ุทูุจุงุช_ูุนููุฉ": 5, "ุตูุญุฉ": "ูุณู_ุงูุตูุงูุฉ.py"},
        "ูุณู ุงูุฒุฑุงุนุฉ": {"ุญุงูุฉ": "ููุชุงุฒ", "ููุงู_ุฑู_ูุนููุฉ": 0, "ุตูุญุฉ": "ูุณู_ุงูุฒุฑุงุนุฉ.py"},
        "ูุณู ุงูุจุญุฑูุฉ": {"ุญุงูุฉ": "ุฌูุฏ", "ุญูุงุฏุซ_ุงูููู": 0, "ุตูุญุฉ": "ูุณู_ุงูุจุญุฑูุฉ.py"},
        "ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ": {"ุญุงูุฉ": "ุฌูุฏ", "ุทูุจุงุช_ุงุฌุงุฒุฉ": 1, "ุตูุญุฉ": "ุงูููุงุฑุฏ_ุงูุจุดุฑูุฉ.py"},
        "ุชูููุฉ ุงููุนูููุงุช (IT)": {"ุญุงูุฉ": "ูุง ุชูุฌุฏ ูุดุงูู", "ูุดุงูู_ุฏุนู": 0, "ุตูุญุฉ": "ุชูููุฉ_ุงููุนูููุงุช.py"},
        "ุงููุญุงุณุจุฉ": {"ุญุงูุฉ": "ุฌูุฏ", "ูุฏููุนุงุช_ูุนููุฉ": 0, "ุตูุญุฉ": "ุงููุญุงุณุจุฉ.py"},
        "ูุณุงุนุฏุฉ ุงููุฏูุฑุฉ": {"ุญุงูุฉ": "ูุณุชูุฑุฉ", "ููุงู_ูุนููุฉ": 2, "ุตูุญุฉ": "ูุณุงุนุฏุฉ_ุงููุฏูุฑุฉ.py"},
    }

def load_admin_tasks():
    """
    ุชุญููู ุงูููุงู ุงูุฅุฏุงุฑูุฉ ุงููุนููุฉ (ููููุฉ ุญุงููุงู).
    """
    tasks = [
        {"ุงููููุฉ": "ูุฑุงุฌุนุฉ ูุดููุงุช ุงูุฏูุงู ุงูููุงุฆูุฉ ูุดูุฑ ููููู.", "ุงูุญุงูุฉ": "ูุนููุฉ", "ุงูููุนุฏ_ุงูููุงุฆู": "2025-07-05"},
        {"ุงููููุฉ": "ุนูุฏ ุงุฌุชูุงุน ูุน ุงูุดุฑูุฉ ุงูุฃูููุฉ ููุฑุงุฌุนุฉ ุจุฑูุชููููุงุช ุงูุฃูุงู.", "ุงูุญุงูุฉ": "ูุนููุฉ", "ุงูููุนุฏ_ุงูููุงุฆู": "2025-07-08"},
        {"ุงููููุฉ": "ุงูุชุฃูุฏ ูู ุชููุฑ ุฌููุน ููุงุฏ ุงููุธุงูุฉ ูู ุฏูุฑุงุช ุงูููุงู ุงููุนููุฉ.", "ุงูุญุงูุฉ": "ูุนููุฉ", "ุงูููุนุฏ_ุงูููุงุฆู": "2025-07-01"},
        {"ุงููููุฉ": "ูุชุงุจุนุฉ ุทูุจุงุช ุงูุตูุงูุฉ ุงููุนููุฉ ูุน ูุณู ุงูุตูุงูุฉ.", "ุงูุญุงูุฉ": "ูุณุชูุฑุฉ", "ุงูููุนุฏ_ุงูููุงุฆู": "ูููู"},
    ]
    return pd.DataFrame(tasks)

# --- ุงูููุฏ ุงูุฑุฆูุณู ูุตูุญุฉ ุงูุฅุฏุงุฑุฉ ---

def run():
    st.title("๐ข ููุญุฉ ุชุญูู ุงูุฅุฏุงุฑุฉ")
    st.info("ููุญุฉ ุนุงูุฉ ุนู ุญุงูุฉ ุงููุงุฌูุฉ ุงูุจุญุฑูุฉ ูุงูููุงู ุงูุฅุฏุงุฑูุฉ.")

    # --- ูุณู ููุญุฉ ุงูุฅูุฌุงุฒุงุช/ุงูููุฎุต (ุงููุฑูุช - Cards) ---
    st.header("ููุฎุต ุญุงูุฉ ุงูุฃูุณุงู ุงูุฑุฆูุณูุฉ")

    summary_data = get_summary_data()
    
    # ุชูุณูู ุงููุฑูุช ุนูู ุตูููุ ูู ุตู 3 ุฃุนูุฏุฉ
    sections = list(summary_data.keys())
    
    # ูุงุฆูุฉ ุจุฃุณูุงุก ุงููููุงุช ุงูุชู ูุฌุจ ุฃู ุชููู ููุฌูุฏุฉ ูู ูุฌูุฏ pages
    # ูุฐู ุงููุงุฆูุฉ ูููุฉ ุฌุฏุงู ูุชุฌูุจ ุฃุฎุทุงุก "File not found"
    existing_pages = [
        "ุงูููุงู_ุงูููููุฉ.py", "ุฏูุฑุงุช_ุงูููุงู.py", "ุงูุดูุงุทุฆ.py",
        "ุงูููุธููู.py", "ุงูุฅุฏุงุฑุฉ.py", "ุงูุทูุงุฑุฆ.py", # ุฅุฐุง ูุงูุช ุตูุญุฉ ุงูุทูุงุฑุฆ ููุฌูุฏุฉ
        # ุฃุถู ููุง ุฃู ูููุงุช ุตูุญุงุช ุฃุฎุฑู ููุฌูุฏุฉ ูุฏูู ุจุงููุนู ูู ูุฌูุฏ pages
    ]
    
    # ูุญุฏุฏ ุงูุตููู ุงูุชู ุชุญุชูู ุนูู ุงููุดุฑููู ูุงูุฅุฏุงุฑุฉ ููู ูุณุชุฎุฏู ุฃุณูุงุฆูู ุงูุตุญูุญุฉ ูู app.py
    # ูุฐุง ุฌุฒุก ูุชูุถูุญ ุงูููุฑุฉุ ูู ุงูุชุทุจูู ุงููุนูู ุฑุจูุง ูููู ูุฏูู ูุงุฆูุฉ ุฏููุงููููุฉ
    page_map = {
        "ุงูุดูุงุทุฆ ูุงููุงุดูุฑุงุช": "ุงูุดูุงุทุฆ.py",
        "ุฏูุฑุงุช ุงูููุงู": "ุฏูุฑุงุช_ุงูููุงู.py",
        "ุงููุดุฑููู": "ุงูููุธููู.py", # ุงูุฑุจุท ุจุงูุงุณู ุงููุนูู ูููู ุงูููุธููู.py
        "ุงูุฅุฏุงุฑุฉ": "ุงูุฅุฏุงุฑุฉ.py",
        # ุฃุถู ููุง ุจููุฉ ุงูุฑูุงุจุท ูุตูุญุงุช ุชูุตูููุฉ ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
    }
    
    # ุฅูุดุงุก ุงููุฑูุช
    for i in range(0, len(sections), 3):
        cols = st.columns(3)
        for j in range(3):
            if i + j < len(sections):
                section_name = sections[i+j]
                data = summary_data[section_name]
                
                with cols[j]:
                    st.markdown(f"#### {section_name}")
                    if data["ุญุงูุฉ"] == "ุฌูุฏ" or data["ุญุงูุฉ"] == "ููุชุงุฒ" or data["ุญุงูุฉ"] == "ุชุดุบูู ุทุจูุนู" or data["ุญุงูุฉ"] == "ูุชููุฑ" or data["ุญุงูุฉ"] == "ุฌุงูุฒูู" or data["ุญุงูุฉ"] == "ูุง ุชูุฌุฏ ูุดุงูู" or data["ุญุงูุฉ"] == "ูุณุชูุฑุฉ":
                        st.success(f"ุงูุญุงูุฉ: {data['ุญุงูุฉ']}")
                    elif data["ุญุงูุฉ"] == "ูุญุชุงุฌ ูุชุงุจุนุฉ" or data["ุญุงูุฉ"] == "ููุฏ ุงููุฑุงุฌุนุฉ" or data["ุญุงูุฉ"] == "ูุณุชูุฑุฉ":
                        st.warning(f"ุงูุญุงูุฉ: {data['ุญุงูุฉ']}")
                    else:
                        st.error(f"ุงูุญุงูุฉ: {data['ุญุงูุฉ']}") # ูุฃู ุญุงูุฉ ุฃุฎุฑู ุบูุฑ ุฌูุฏุฉ

                    # ุนุฑุถ ูุคุดุฑุงุช KPI ุงููุญุฏุฏุฉ
                    for key, value in data.items():
                        if key not in ["ุญุงูุฉ", "ุตูุญุฉ"]:
                            st.metric(label=key.replace("_", " ").title(), value=value)
                    
                    # ุฒุฑ "ุนุฑุถ ุงูุชูุงุตูู" ููุงูุชูุงู ุฅูู ุงูุตูุญุฉ ุงูุฎุงุตุฉ ุจุงููุณู
                    # ูุชุญูู ูู ูุฌูุฏ ููู ุงูุตูุญุฉ ูุจู ูุถุน ุฒุฑ ุงูุชููู ูุชุฌูุจ ุงูุฃุฎุทุงุก
                    target_page_file = page_map.get(section_name) # ุงุณุชุฎุฏู page_map ุฃููุงู
                    if target_page_file and target_page_file in existing_pages:
                         if st.button(f"ุนุฑุถ ุชูุงุตูู {section_name}", key=f"btn_{section_name}"):
                            st.switch_page(f"pages/{target_page_file}")
                    else:
                        st.info("ูุง ุชูุฌุฏ ุตูุญุฉ ุชูุตูููุฉ ุญุงููุงู.") # ุฃู ูุง ุชุนุฑุถ ุงูุฒุฑ

    st.markdown("---") # ุฎุท ูุงุตู

    # --- ูุณู ุงูููุงู ุงูุฅุฏุงุฑูุฉ ุงููุนููุฉ ---
    st.header("ุงูููุงู ุงูุฅุฏุงุฑูุฉ ุงููุนููุฉ")

    admin_tasks = load_admin_tasks()

    if not admin_tasks.empty:
        for index, task in admin_tasks.iterrows():
            st.markdown(f"**ุงููููุฉ:** {task['ุงููููุฉ']}")
            # ุชูููู ุงูุญุงูุฉ
            status_color = "red" if task['ุงูุญุงูุฉ'] == 'ูุนููุฉ' else "orange" if task['ุงูุญุงูุฉ'] == 'ูุณุชูุฑุฉ' else "green"
            st.markdown(f"**ุงูุญุงูุฉ:** <span style='color: {status_color}; font-weight:bold;'>{task['ุงูุญุงูุฉ']}</span>", unsafe_allow_html=True)
            if pd.notna(task['ุงูููุนุฏ_ุงูููุงุฆู']):
                st.markdown(f"**ุงูููุนุฏ ุงูููุงุฆู:** {task['ุงูููุนุฏ_ุงูููุงุฆู']}")
            st.markdown("---")
    else:
        st.info("ูุง ุชูุฌุฏ ููุงู ุฅุฏุงุฑูุฉ ูุนููุฉ ุญุงููุงู.")

# ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ูุชุดุบูู ุงูุตูุญุฉ
run()
